<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>PrintMaster Server</title>
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><rect x='16' y='8' width='32' height='12' fill='%234a5568' rx='2'/><rect x='12' y='20' width='40' height='24' fill='%23718096' rx='3'/><rect x='16' y='24' width='32' height='16' fill='%23cbd5e0' rx='2'/><rect x='20' y='28' width='8' height='2' fill='%234299e1'/><rect x='20' y='32' width='12' height='2' fill='%234299e1'/><rect x='20' y='36' width='10' height='2' fill='%234299e1'/><circle cx='46' cy='32' r='3' fill='%2348bb78'/><rect x='16' y='44' width='32' height='12' fill='%234a5568' rx='2'/><rect x='20' y='48' width='24' height='4' fill='%23e2e8f0'/></svg>">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>
    <div class="header-flex"
        style="display: flex; align-items: center; margin-bottom: 12px; justify-content: space-between;">
        <div style="display: flex; align-items: center; gap: 20px;">
            <h1 style="margin: 0;">PrintMaster Server</h1>
            <div id="server_status" style="font-size:14px;color:var(--muted);">Loading...</div>
        </div>
        <label class="theme-toggle">
            <input type="checkbox" id="theme-toggle-checkbox">
            <div class="theme-toggle-slider">
                <div class="theme-toggle-icon"></div>
            </div>
        </label>
    </div>

    <!-- Main content container with floating appearance -->
    <div class="content-container">
        <div class="tabbar">
            <!-- Hamburger menu for mobile -->
            <div class="hamburger-menu">
                <div class="hamburger-header">
                    <span id="current_tab_label">Menu - Agents</span>
                    <div class="hamburger-icon">
                        <div></div>
                        <div></div>
                        <div></div>
                    </div>
                </div>
            </div>
            <div class="mobile-nav" id="mobile_nav">
                <button class="tab active" data-target="agents">Agents</button>
                <button class="tab" data-target="devices">Devices</button>
                <button class="tab" data-target="settings">Settings</button>
                <button class="tab" data-target="logs">Logs</button>
            </div>
            <!-- Desktop tabs -->
            <button class="tab active" data-target="agents">Agents</button>
            <button class="tab" data-target="devices">Devices</button>
            <button class="tab" data-target="settings">Settings</button>
            <button class="tab" data-target="logs">Logs</button>
        </div>

        <!-- Agents Tab -->
        <div style="margin-top:12px;" data-tab="agents">
            <h3>Connected Agents</h3>
            <div id="agents_stats" style="display:flex;gap:12px;margin-bottom:12px;font-size:13px;"></div>
            <div id="agents_list">
                <div style="color:var(--muted);">Loading agents...</div>
            </div>
        </div>

        <!-- Devices Tab -->
        <div style="margin-top:12px;" data-tab="devices" class="hidden">
            <h3>All Devices</h3>
            
            <div style="display:flex;gap:12px;align-items:center;margin-bottom:12px;flex-wrap:wrap;">
                <input type="text" id="devices_search" placeholder="Search devices..."
                    style="padding:6px 12px;width:200px;" />
                <select id="devices_agent_filter" style="padding:6px 12px;">
                    <option value="">All Agents</option>
                </select>
            </div>

            <div id="devices_stats" style="display:flex;gap:12px;margin-bottom:12px;font-size:13px;"></div>
            <div class="device-cards-container" id="devices_cards"></div>
        </div>

        <!-- Settings Tab -->
        <div style="margin-top:12px;" data-tab="settings" class="hidden">
            <h3>Server Settings</h3>

            <!-- Settings Controls (Sticky) -->
            <div class="settings-sticky-bar">
                <label id="autosave_label">
                    <input type="checkbox" id="settings_autosave" />
                    <span style="font-weight:500;font-size:14px;">Auto-save</span>
                </label>
                <div id="settings_buttons" class="settings-buttons">
                    <button id="settings_apply_btn">Apply</button>
                    <button id="settings_revert_btn">Revert</button>
                    <button id="settings_reset_btn">Reset</button>
                </div>
                <div id="autosave_feedback" class="autosave-feedback">âœ“ Settings saved</div>
            </div>

            <!-- Settings Grid Container -->
            <div class="settings-grid">

                <!-- Server Configuration -->
                <div class="panel">
                    <h4 style="margin-top:0;color:var(--highlight)">Server Configuration</h4>
                    <div style="display:flex;flex-direction:column;gap:12px;">
                        <label style="display:flex;align-items:center;gap:8px;">
                            <span style="min-width:200px;">HTTP Port:</span>
                            <input id="server_http_port" type="number" style="width:120px" value="9090" />
                            <span style="color:var(--muted);font-size:12px;">Agent API port</span>
                        </label>
                        <label style="display:flex;align-items:center;gap:8px;">
                            <span style="min-width:200px;">HTTPS Port:</span>
                            <input id="server_https_port" type="number" style="width:120px" value="9443" />
                            <span style="color:var(--muted);font-size:12px;">Web UI port</span>
                        </label>
                        <label style="display:flex;align-items:center;gap:8px;">
                            <span style="min-width:200px;">Database Path:</span>
                            <input id="server_db_path" type="text" style="width:320px" placeholder="Auto-detected" />
                            <span style="color:var(--muted);font-size:12px;">SQLite database location</span>
                        </label>
                    </div>
                </div>

                <!-- Agent Management -->
                <div class="panel">
                    <h4 style="margin-top:0;color:var(--highlight)">Agent Management</h4>
                    <div style="display:flex;flex-direction:column;gap:12px;">
                        <label style="display:flex;align-items:center;gap:8px;">
                            <input type="checkbox" id="auto_approve_agents" />
                            <span>Auto-approve new agents</span>
                            <span style="color:var(--muted);font-size:12px;">TODO: Allow without manual approval</span>
                        </label>
                        <label style="display:flex;align-items:center;gap:8px;">
                            <span style="min-width:200px;">Agent timeout (minutes):</span>
                            <input id="agent_timeout" type="number" style="width:120px" min="5" max="60" value="15" />
                            <span style="color:var(--muted);font-size:12px;">Mark offline after N minutes</span>
                        </label>
                    </div>
                </div>

                <!-- Data Retention -->
                <div class="panel">
                    <h4 style="margin-top:0;color:var(--highlight)">Data Retention</h4>
                    <div style="display:flex;flex-direction:column;gap:12px;">
                        <label style="display:flex;align-items:center;gap:8px;">
                            <span style="min-width:200px;">Metrics retention (days):</span>
                            <input id="metrics_retention_days" type="number" style="width:120px" min="30" max="1825" value="365" />
                            <span style="color:var(--muted);font-size:12px;">Keep metrics history</span>
                        </label>
                        <label style="display:flex;align-items:center;gap:8px;">
                            <span style="min-width:200px;">Audit log retention (days):</span>
                            <input id="audit_retention_days" type="number" style="width:120px" min="30" max="1825" value="90" />
                            <span style="color:var(--muted);font-size:12px;">Keep audit entries</span>
                        </label>
                    </div>
                </div>

                <!-- Logging Settings -->
                <div class="panel">
                    <h4 style="margin-top:0;color:var(--highlight)">Logging Settings</h4>
                    <div style="display:flex;flex-direction:column;gap:12px;">
                        <label style="display:flex;align-items:center;gap:8px;">
                            <span style="min-width:200px;">Log Level:</span>
                            <select id="log_level" style="width:180px;">
                                <option value="error">ERROR - Only errors</option>
                                <option value="warn">WARN - Warnings and errors</option>
                                <option value="info" selected>INFO - Normal operations</option>
                                <option value="debug">DEBUG - Detailed debugging</option>
                                <option value="trace">TRACE - Very verbose</option>
                            </select>
                        </label>
                    </div>
                </div>

            </div> <!-- End settings-grid -->
        </div>

        <!-- Logs Tab -->
        <div class="hidden" style="margin-top:12px;" data-tab="logs">
            <h3>Server Log</h3>
            <div style="display:flex;align-items:center;gap:12px;margin-bottom:6px;flex-wrap:wrap;">
                <label style="font-size:13px;color:var(--muted)"><input type="checkbox" id="pause_autoscroll" /> Pause
                    auto-scroll</label>
                <select id="log_level_filter" style="padding:4px 8px;font-size:13px;">
                    <option value="">All Levels</option>
                    <option value="ERROR">ERROR</option>
                    <option value="WARN">WARN</option>
                    <option value="INFO">INFO</option>
                    <option value="DEBUG">DEBUG</option>
                    <option value="TRACE">TRACE</option>
                </select>
                <input type="text" id="log_search_filter" placeholder="Search logs..." 
                    style="padding:4px 8px;font-size:13px;width:150px;" />
                <button id="copy_logs_btn">Copy Logs</button>
                <button id="download_logs_btn">Download Logs</button>
                <button id="clear_log_btn">Clear Log</button>
            </div>
            <pre id="log"
                style="max-height:360px; overflow:auto; background:#073642; color:var(--text); padding:10px; border-radius:6px; border:1px solid #002b36; font-family:monospace; white-space:pre-wrap;"></pre>
        </div>

    </div> <!-- End content-container -->

    <!-- Toast notification container -->
    <div class="toast-container" id="toast_container"></div>

    <!-- Confirmation Modal -->
    <div class="modal" id="confirm_modal" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-title" id="confirm_modal_title">Confirm Action</span>
                <span class="modal-close" id="confirm_modal_close_x">&times;</span>
            </div>
            <div class="modal-body">
                <p id="confirm_modal_message">Are you sure?</p>
            </div>
            <div class="modal-footer">
                <button class="modal-button modal-button-secondary" id="confirm_modal_cancel">Cancel</button>
                <button class="modal-button modal-button-primary" id="confirm_modal_confirm">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Agent Details Modal -->
    <div class="modal" id="agent_details_modal" style="display:none;">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <span class="modal-title" id="agent_details_title">Agent Details</span>
                <span class="modal-close" id="agent_details_close_x">&times;</span>
            </div>
            <div class="modal-body" id="agent_details_body" style="max-height: 500px; overflow-y: auto;">
                <div style="color:var(--muted);">Loading...</div>
            </div>
            <div class="modal-footer">
                <button class="modal-button modal-button-secondary" id="agent_details_close">Close</button>
            </div>
        </div>
    </div>

    <script src="/static/app.js"></script>

</body>

</html>
