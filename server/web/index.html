<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>PrintMaster Server</title>
    <script>window.__pm_shared = window.__pm_shared || {};</script>
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><rect x='16' y='8' width='32' height='12' fill='%234a5568' rx='2'/><rect x='12' y='20' width='40' height='24' fill='%23718096' rx='3'/><rect x='16' y='24' width='32' height='16' fill='%23cbd5e0' rx='2'/><rect x='20' y='28' width='8' height='2' fill='%234299e1'/><rect x='20' y='32' width='12' height='2' fill='%234299e1'/><rect x='20' y='36' width='10' height='2' fill='%234299e1'/><circle cx='46' cy='32' r='3' fill='%2348bb78'/><rect x='16' y='44' width='32' height='12' fill='%234a5568' rx='2'/><rect x='20' y='48' width='24' height='4' fill='%23e2e8f0'/></svg>">
    <!-- flatpickr is injected centrally from common/web/shared.js -->
    <link rel="stylesheet" href="/static/shared.css">
    <link rel="stylesheet" href="/static/style.css">
    <script src="/static/shared.js"></script>
    <script src="/static/cards.js"></script>
    <script src="/static/metrics.js"></script>
</head>

<body>
    <div class="header-flex"
        style="display: flex; align-items: center; margin-bottom: 12px; justify-content: space-between;">
        <div style="display: flex; align-items: center; gap: 20px;">
            <h1 style="margin: 0;">PrintMaster Server</h1>
            <div id="server_status" style="font-size:14px;color:var(--muted);">Loading...</div>
        </div>
        <div style="display:flex;align-items:center;gap:12px;">
            <button id="join_token_btn" title="Add an agent" class="modal-button modal-button-primary" style="display:none;">Add Agent</button>
            <label class="theme-toggle">
                <input type="checkbox" id="theme-toggle-checkbox">
                <div class="theme-toggle-slider">
                    <div class="theme-toggle-icon"></div>
                </div>
            </label>
            <button id="logout_btn" style="display:none;" title="Log out" class="modal-button">Log out</button>
        </div>
    </div>

    <!-- Main content container with floating appearance -->
    <div class="content-container">
        <div class="tabbar">
            <!-- Hamburger menu for mobile -->
            <div class="hamburger-menu">
                <div class="hamburger-header">
                    <span id="current_tab_label">Menu - Agents</span>
                    <div class="hamburger-icon">
                        <div></div>
                        <div></div>
                        <div></div>
                    </div>
                </div>
            </div>
            <div class="mobile-nav" id="mobile_nav">
                <button class="tab active" data-target="agents">Agents</button>
                <button class="tab" data-target="devices">Devices</button>
                <button class="tab" data-target="metrics">Metrics</button>
                <button class="tab" data-target="logs">Logs</button>
            </div>
            <!-- Desktop tabs -->
            <div class="desktop-tabs" id="desktop_tabs">
                <button class="tab active" data-target="agents">Agents</button>
                <button class="tab" data-target="devices">Devices</button>
                <button class="tab" data-target="metrics">Metrics</button>
                <button class="tab" data-target="logs">Logs</button>
            </div>
        </div>

        <!-- Agents Tab -->
        <div style="margin-top:12px;" data-tab="agents">
            <h3>Connected Agents</h3>
            <div id="agents_stats" style="display:flex;gap:12px;margin-bottom:12px;font-size:13px;"></div>
            <div id="agents_list">
                <div style="color:var(--muted);">Loading agents...</div>
            </div>
        </div>

        <!-- Devices Tab -->
        <div style="margin-top:12px;" data-tab="devices" class="hidden">
            <h3>All Devices</h3>
            
            <div style="display:flex;gap:12px;align-items:center;margin-bottom:12px;flex-wrap:wrap;">
                <input type="text" id="devices_search" placeholder="Search devices..."
                    style="padding:6px 12px;width:200px;" />
                <select id="devices_agent_filter" style="padding:6px 12px;">
                    <option value="">All Agents</option>
                </select>
            </div>

            <div id="devices_stats" style="display:flex;gap:12px;margin-bottom:12px;font-size:13px;"></div>
            <div class="device-cards-container" id="devices_cards"></div>
        </div>

        <!-- Metrics Tab -->
        <div style="margin-top:12px;" data-tab="metrics" class="hidden">
            <h3>Metrics</h3>
            <div id="metrics_stats" style="display:flex;gap:12px;margin-bottom:12px;font-size:13px;"></div>
            <div id="metrics_content" style="font-size:13px;color:var(--muted)">Loading metrics...</div>
        </div>

        <!-- Tenants / Customers Tab (rendered dynamically) -->
        <template id="tab-template-tenants">
            <div style="margin-top:12px;" data-tab="tenants" class="hidden">
                <h3>Customers</h3>
                <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:12px;">
                    <div style="color:var(--muted);">Manage tenants and onboarding tokens</div>
                    <div>
                        <button id="new_tenant_btn">New Tenant</button>
                    </div>
                </div>

                <div id="tenants_list">
                    <div style="color:var(--muted);">Loading tenants...</div>
                </div>
            </div>
        </template>

        <!-- Settings Tab (rendered dynamically) -->
        <template id="tab-template-settings">
            <div style="margin-top:12px;" data-tab="settings" class="hidden">
                <h3>Server Settings</h3>

                <!-- Settings Controls (Sticky) -->
                <div class="settings-sticky-bar">
                    <label id="autosave_label">
                        <input type="checkbox" id="settings_autosave" />
                        <span style="font-weight:500;font-size:14px;">Auto-save</span>
                    </label>
                    <div id="settings_buttons" class="settings-buttons">
                        <button id="settings_apply_btn">Apply</button>
                        <button id="settings_revert_btn">Revert</button>
                        <button id="settings_reset_btn">Reset</button>
                    </div>
                    <div id="autosave_feedback" class="autosave-feedback">✓ Settings saved</div>
                </div>

                <!-- Settings Grid Container -->
                <div class="settings-grid">

                    <!-- Server Configuration -->
                    <div class="panel">
                        <h4 style="margin-top:0;color:var(--highlight)">Server Configuration</h4>
                        <div style="display:flex;flex-direction:column;gap:12px;">
                            <label style="display:flex;align-items:center;gap:8px;">
                                <span style="min-width:200px;">HTTP Port:</span>
                                <input id="server_http_port" type="number" style="width:120px" value="9090" />
                                <span style="color:var(--muted);font-size:12px;">Agent API port</span>
                            </label>
                            <label style="display:flex;align-items:center;gap:8px;">
                                <span style="min-width:200px;">HTTPS Port:</span>
                                <input id="server_https_port" type="number" style="width:120px" value="9443" />
                                <span style="color:var(--muted);font-size:12px;">Web UI port</span>
                            </label>
                            <label style="display:flex;align-items:center;gap:8px;">
                                <span style="min-width:200px;">Database Path:</span>
                                <input id="server_db_path" type="text" style="width:320px" placeholder="Auto-detected" />
                                <span style="color:var(--muted);font-size:12px;">SQLite database location</span>
                            </label>
                        </div>
                    </div>

                    <!-- Single Sign-On -->
                    <div class="panel">
                        <h4 style="margin-top:0;color:var(--highlight)">Single Sign-On (OIDC)</h4>
                        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:12px;flex-wrap:wrap;">
                            <div style="color:var(--muted);font-size:13px;max-width:520px;">
                                Connect identity providers for the hosted login page. Providers can be tenant-specific or global.
                            </div>
                            <div>
                                <button id="sso_add_provider_btn">Add Provider</button>
                            </div>
                        </div>
                        <div id="sso_providers_list" class="card" style="padding:12px;overflow:auto;">
                            <div class="muted-text">Loading identity providers…</div>
                        </div>
                    </div>

                    <!-- Email / SMTP -->
                    <div class="panel">
                        <h4 style="margin-top:0;color:var(--highlight)">Email (SMTP)</h4>
                        <div style="display:flex;flex-direction:column;gap:12px;">
                            <label style="display:flex;align-items:center;gap:8px;">
                                <input type="checkbox" id="smtp_enabled" />
                                <span style="font-weight:500;font-size:14px;">Enable SMTP</span>
                            </label>
                            <label style="display:flex;align-items:center;gap:8px;">
                                <span style="min-width:200px;">SMTP Host:</span>
                                <input id="smtp_host" type="text" style="width:320px" placeholder="smtp.example.com" />
                            </label>
                            <label style="display:flex;align-items:center;gap:8px;">
                                <span style="min-width:200px;">SMTP Port:</span>
                                <input id="smtp_port" type="number" style="width:120px" value="587" />
                            </label>
                            <label style="display:flex;align-items:center;gap:8px;">
                                <span style="min-width:200px;">SMTP User:</span>
                                <input id="smtp_user" type="text" style="width:320px" placeholder="user@example.com" />
                            </label>
                            <label style="display:flex;align-items:center;gap:8px;">
                                <span style="min-width:200px;">SMTP Password:</span>
                                <input id="smtp_pass" type="password" style="width:320px" placeholder="secret" />
                            </label>
                            <label style="display:flex;align-items:center;gap:8px;">
                                <span style="min-width:200px;">From Address:</span>
                                <input id="smtp_from" type="text" style="width:320px" placeholder="no-reply@example.com" />
                            </label>
                            <label style="display:flex;align-items:center;gap:8px;">
                                <span style="min-width:200px;">Test Recipient:</span>
                                <input id="smtp_test_to" type="text" style="width:320px" placeholder="your-email@example.com" />
                                <button type="button" class="btn" onclick="sendTestEmail()">Send test email</button>
                            </label>
                        </div>
                    </div>

                    <!-- Agent Management -->
                    <div class="panel">
                        <h4 style="margin-top:0;color:var(--highlight)">Agent Management</h4>
                        <div style="display:flex;flex-direction:column;gap:12px;">
                            <label style="display:flex;align-items:center;gap:8px;">
                                <input type="checkbox" id="auto_approve_agents" />
                                <span>Auto-approve new agents</span>
                                <span style="color:var(--muted);font-size:12px;">TODO: Allow without manual approval</span>
                            </label>
                            <label style="display:flex;align-items:center;gap:8px;">
                                <span style="min-width:200px;">Agent timeout (minutes):</span>
                                <input id="agent_timeout" type="number" style="width:120px" min="5" max="60" value="15" />
                                <span style="color:var(--muted);font-size:12px;">Mark offline after N minutes</span>
                            </label>
                        </div>
                    </div>

                    <!-- Data Retention -->
                    <div class="panel">
                        <h4 style="margin-top:0;color:var(--highlight)">Data Retention</h4>
                        <div style="display:flex;flex-direction:column;gap:12px;">
                            <label style="display:flex;align-items:center;gap:8px;">
                                <span style="min-width:200px;">Metrics retention (days):</span>
                                <input id="metrics_retention_days" type="number" style="width:120px" min="30" max="1825" value="365" />
                                <span style="color:var(--muted);font-size:12px;">Keep metrics history</span>
                            </label>
                            <label style="display:flex;align-items:center;gap:8px;">
                                <span style="min-width:200px;">Audit log retention (days):</span>
                                <input id="audit_retention_days" type="number" style="width:120px" min="30" max="1825" value="90" />
                                <span style="color:var(--muted);font-size:12px;">Keep audit entries</span>
                            </label>
                        </div>
                    </div>

                    <!-- Logging Settings -->
                    <div class="panel">
                        <h4 style="margin-top:0;color:var(--highlight)">Logging Settings</h4>
                        <div style="display:flex;flex-direction:column;gap:12px;">
                            <label style="display:flex;align-items:center;gap:8px;">
                                <span style="min-width:200px;">Log Level:</span>
                                <select id="log_level" style="width:180px;">
                                    <option value="error">ERROR - Only errors</option>
                                    <option value="warn">WARN - Warnings and errors</option>
                                    <option value="info" selected>INFO - Normal operations</option>
                                    <option value="debug">DEBUG - Detailed debugging</option>
                                    <option value="trace">TRACE - Very verbose</option>
                                </select>
                            </label>
                        </div>
                    </div>

                </div> <!-- End settings-grid -->
            </div>
        </template>

        <!-- Users Tab (rendered dynamically) -->
        <template id="tab-template-users">
            <div style="margin-top:12px;" data-tab="users" class="hidden">
                <h3>Users</h3>
                <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:12px;">
                    <div style="color:var(--muted);">Manage local users and roles</div>
                    <div>
                        <button id="new_user_btn">New User</button>
                    </div>
                </div>

                <div id="users_list">
                    <div style="color:var(--muted);">Loading users...</div>
                </div>
            </div>
        </template>

        <!-- Logs Tab -->
        <div class="hidden" style="margin-top:12px;" data-tab="logs">
            <h3>Logs</h3>
            <div class="subtab-bar" id="logs_subtab_bar">
                <button class="subtab log-subtab active" data-logview="system">System Logs</button>
                <button class="subtab log-subtab" data-logview="audit" data-role="admin" style="display:none">Audit Logs</button>
            </div>

            <div class="panel log-panel" data-logview-panel="system">
                <div class="log-controls">
                    <label class="log-control"><input type="checkbox" id="pause_autoscroll" /> Pause auto-scroll</label>
                    <select id="log_level_filter">
                        <option value="">All Levels</option>
                        <option value="ERROR">ERROR</option>
                        <option value="WARN">WARN</option>
                        <option value="INFO">INFO</option>
                        <option value="DEBUG">DEBUG</option>
                        <option value="TRACE">TRACE</option>
                    </select>
                    <input type="text" id="log_search_filter" placeholder="Search logs..." />
                    <button id="copy_logs_btn">Copy Logs</button>
                    <button id="download_logs_btn">Download Logs</button>
                    <button id="clear_log_btn">Clear Log</button>
                </div>
                <pre id="log"></pre>
            </div>

            <div class="panel log-panel hidden" data-logview-panel="audit" data-role="admin" style="display:none">
                <div class="log-controls audit-controls">
                    <label class="log-control">
                        <span>Time Range</span>
                        <select id="audit_time_filter">
                            <option value="24">Last 24h</option>
                            <option value="168">Last 7 days</option>
                            <option value="720">Last 30 days</option>
                        </select>
                    </label>
                    <label class="log-control">
                        <span>Agent ID</span>
                        <input type="text" id="audit_agent_filter" placeholder="Optional agent UUID" />
                    </label>
                    <button id="refresh_audit_logs_btn">Refresh</button>
                </div>
                <div id="audit_logs_table" class="table-wrapper">
                    <div class="muted-text">Audit entries load here for admins.</div>
                </div>
            </div>
        </div>

    </div> <!-- End content-container -->

    <!-- Toast notification container -->
    <div class="toast-container" id="toast_container"></div>

    <!-- Login Modal -->
    <div class="modal" id="login_modal" style="display:none;">
        <div class="modal-content" style="max-width:420px;">
            <div class="modal-header">
                <span class="modal-title">Sign In</span>
            </div>
            <div class="modal-body">
                <div style="margin-bottom:8px;color:var(--muted);">Sign in to access PrintMaster.</div>
                <label style="display:block;margin-bottom:6px;">Username</label>
                <input id="login_username" type="text" style="width:100%;padding:8px;margin-bottom:8px;border-radius:4px;border:1px solid var(--border);" />
                <label style="display:block;margin-bottom:6px;">Password</label>
                <input id="login_password" type="password" style="width:100%;padding:8px;margin-bottom:8px;border-radius:4px;border:1px solid var(--border);" />
                <div id="login_error" style="color:var(--danger);display:none;margin-bottom:8px;font-size:13px;"></div>
            </div>
            <div class="modal-footer">
                <button class="modal-button modal-button-secondary" id="login_cancel">Cancel</button>
                <button class="modal-button modal-button-primary" id="login_submit">Sign In</button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal" id="confirm_modal" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-title" id="confirm_modal_title">Confirm Action</span>
                <span class="modal-close" id="confirm_modal_close_x">&times;</span>
            </div>
            <div class="modal-body">
                <p id="confirm_modal_message">Are you sure?</p>
            </div>
            <div class="modal-footer">
                <button class="modal-button modal-button-secondary" id="confirm_modal_cancel">Cancel</button>
                <button class="modal-button modal-button-primary" id="confirm_modal_confirm">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Agent Details Modal -->
    <div class="modal" id="agent_details_modal" style="display:none;">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <span class="modal-title" id="agent_details_title">Agent Details</span>
                <span class="modal-close" id="agent_details_close_x">&times;</span>
            </div>
            <div class="modal-body" id="agent_details_body" style="max-height: 500px; overflow-y: auto;">
                <div style="color:var(--muted);">Loading...</div>
            </div>
            <div class="modal-footer">
                <button class="modal-button modal-button-secondary" id="agent_details_close">Close</button>
            </div>
        </div>
    </div>

    <!-- Printer Details modal with overlay (shared) -->
    <div id="printer_details_overlay" class="modal" style="display:none;">
        <div id="printer_details_modal" class="printer-details-dialog modal-content" style="max-width:900px;">
            <button class="modal-close-x" id="printer_details_close_x" title="Close">&times;</button>
            <h3 id="printer_details_title" style="margin-top:0;color:var(--highlight)">Printer Details</h3>
            <div id="printer_details_body"
                style="overflow-x:hidden;overflow-y:auto;font-family:system-ui;color:var(--text);word-wrap:break-word;flex:1;max-height:60vh;padding-right:8px;">
            </div>
            <div id="printer_details_actions" style="margin-top:16px;display:flex;justify-content:flex-end;gap:8px;flex-shrink:0">
                <button class="modal-button modal-button-secondary" id="printer_details_close">Close</button>
            </div>
        </div>
    </div>

    <!-- Add Agent Multi-step Modal -->
    <div class="modal modal-overlay" id="add_agent_modal" style="display:none;">
        <div class="modal-dialog" style="max-width:720px;">
            <div class="modal-header">
                <span class="modal-title" id="add_agent_title">Add Agent</span>
                <span class="modal-close" id="add_agent_close_x">&times;</span>
            </div>
            <div class="modal-body" id="add_agent_body" style="max-height:520px;overflow-y:auto;">
                <div id="add_agent_step_indicator" style="font-size:13px;color:var(--muted);margin-bottom:8px;">Step 1/3</div>
                <div id="add_agent_content">
                    <!-- Dynamic content rendered by app.js -->
                </div>
            </div>
            <div class="modal-footer" id="add_agent_footer">
                <button class="modal-button modal-button-secondary" id="add_agent_cancel">Cancel</button>
                <button class="modal-button modal-button-primary" id="add_agent_primary">Next</button>
            </div>
        </div>
    </div>

    <!-- Generic Input Modal (used for small prompts, replaces prompt()) -->
    <div class="modal" id="input_modal" style="display:none;">
        <div class="modal-content" style="max-width:520px;">
            <div class="modal-header">
                <span class="modal-title" id="input_modal_title">Input</span>
                <span class="modal-close" id="input_modal_close_x">&times;</span>
            </div>
            <div class="modal-body" id="input_modal_body">
                <div id="input_modal_label" style="margin-bottom:8px;color:var(--muted);"></div>
                <input id="input_modal_input" type="text" style="width:100%;padding:8px;border-radius:4px;border:1px solid var(--border);" />
            </div>
            <div class="modal-footer">
                <button class="modal-button modal-button-secondary" id="input_modal_cancel">Cancel</button>
                <button class="modal-button modal-button-primary" id="input_modal_ok">OK</button>
            </div>
        </div>
    </div>

    <!-- SSO Provider Modal -->
    <div class="modal" id="sso_modal" style="display:none;">
        <div class="modal-content" style="max-width:640px;">
            <div class="modal-header">
                <span class="modal-title" id="sso_modal_title">Add OIDC Provider</span>
                <span class="modal-close" id="sso_modal_close">&times;</span>
            </div>
            <form id="sso_modal_form">
                <div class="modal-body" style="max-height:70vh;overflow:auto;display:flex;flex-direction:column;gap:16px;">
                    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;">
                        <label style="display:flex;flex-direction:column;font-size:13px;gap:6px;">
                            <span>Display Name</span>
                            <input id="sso_display_name" type="text" required style="padding:8px;border-radius:4px;border:1px solid var(--border);" placeholder="Acme SSO" />
                        </label>
                        <label style="display:flex;flex-direction:column;font-size:13px;gap:6px;">
                            <span>Slug</span>
                            <input id="sso_slug" type="text" style="padding:8px;border-radius:4px;border:1px solid var(--border);" placeholder="acme" />
                            <small style="color:var(--muted);">Lowercase letters, numbers, and hyphen.</small>
                        </label>
                        <label style="display:flex;flex-direction:column;font-size:13px;gap:6px;">
                            <span>Tenant Scope</span>
                            <select id="sso_tenant" style="padding:8px;border-radius:4px;border:1px solid var(--border);"></select>
                            <small style="color:var(--muted);">Leave blank to make the provider global.</small>
                        </label>
                        <label style="display:flex;flex-direction:column;font-size:13px;gap:6px;">
                            <span>Default Role</span>
                            <select id="sso_default_role" style="padding:8px;border-radius:4px;border:1px solid var(--border);">
                                <option value="user">User</option>
                                <option value="admin">Admin</option>
                            </select>
                        </label>
                    </div>
                    <label style="display:flex;flex-direction:column;font-size:13px;gap:6px;">
                        <span>Issuer URL</span>
                        <input id="sso_issuer" type="text" style="padding:8px;border-radius:4px;border:1px solid var(--border);" placeholder="https://login.microsoftonline.com/..." />
                    </label>
                    <label style="display:flex;flex-direction:column;font-size:13px;gap:6px;">
                        <span>Client ID</span>
                        <input id="sso_client_id" type="text" style="padding:8px;border-radius:4px;border:1px solid var(--border);" />
                    </label>
                    <label style="display:flex;flex-direction:column;font-size:13px;gap:6px;">
                        <span>Client Secret</span>
                        <input id="sso_client_secret" type="password" style="padding:8px;border-radius:4px;border:1px solid var(--border);" />
                        <small style="color:var(--muted);">Leave blank to keep the existing secret when editing.</small>
                    </label>
                    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;">
                        <label style="display:flex;flex-direction:column;font-size:13px;gap:6px;">
                            <span>Button Text</span>
                            <input id="sso_button_text" type="text" style="padding:8px;border-radius:4px;border:1px solid var(--border);" placeholder="Sign in with Contoso" />
                        </label>
                        <label style="display:flex;flex-direction:column;font-size:13px;gap:6px;">
                            <span>Icon URL</span>
                            <input id="sso_icon" type="text" style="padding:8px;border-radius:4px;border:1px solid var(--border);" placeholder="https://.../logo.svg" />
                        </label>
                    </div>
                    <label style="display:flex;flex-direction:column;font-size:13px;gap:6px;">
                        <span>Button Style (optional CSS classes)</span>
                        <input id="sso_button_style" type="text" style="padding:8px;border-radius:4px;border:1px solid var(--border);" placeholder="btn btn-accent" />
                    </label>
                    <label style="display:flex;flex-direction:column;font-size:13px;gap:6px;">
                        <span>Scopes</span>
                        <input id="sso_scopes" type="text" style="padding:8px;border-radius:4px;border:1px solid var(--border);" />
                        <small style="color:var(--muted);">Separate scopes with spaces or commas. "openid" is always included.</small>
                    </label>
                    <label style="display:flex;align-items:center;gap:8px;font-size:13px;">
                        <input id="sso_auto_login" type="checkbox" />
                        <span>Automatically redirect users to this provider when it is the only option.</span>
                    </label>
                    <div id="sso_modal_error" style="display:none;color:var(--danger);font-size:13px;"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="modal-button modal-button-secondary" id="sso_modal_cancel">Cancel</button>
                    <button type="submit" class="modal-button modal-button-primary" id="sso_modal_submit">Save Provider</button>
                </div>
            </form>
        </div>
    </div>

    <!-- User Modal (create/edit) -->
    <div class="modal" id="user_modal" style="display:none;">
        <div class="modal-content" style="max-width:520px;">
            <div class="modal-header">
                <span class="modal-title" id="user_modal_title">Add User</span>
                <span class="modal-close" id="user_modal_close_x">&times;</span>
            </div>
            <div class="modal-body">
                <label style="display:block;margin-bottom:6px;">Username</label>
                <input id="user_username" type="text" style="width:100%;padding:8px;margin-bottom:8px;border-radius:4px;border:1px solid var(--border);" />
                <label style="display:block;margin-bottom:6px;">Email</label>
                <input id="user_email" type="text" style="width:100%;padding:8px;margin-bottom:8px;border-radius:4px;border:1px solid var(--border);" />
                <label style="display:block;margin-bottom:6px;">Password</label>
                <input id="user_password" type="password" style="width:100%;padding:8px;margin-bottom:8px;border-radius:4px;border:1px solid var(--border);" />
                <label style="display:block;margin-bottom:6px;">Role</label>
                <select id="user_role" style="width:100%;padding:8px;margin-bottom:8px;border-radius:4px;border:1px solid var(--border);">
                    <option value="user">User</option>
                    <option value="readonly">Read-only</option>
                    <option value="admin">Admin</option>
                </select>
                <label style="display:block;margin-bottom:6px;">Tenant (optional)</label>
                <select id="user_tenant" style="width:100%;padding:8px;margin-bottom:8px;border-radius:4px;border:1px solid var(--border);">
                    <option value="">(Global / Server)</option>
                </select>
                <div id="user_error" style="color:var(--danger);display:none;margin-top:6px;"></div>
            </div>
            <div class="modal-footer">
                <button class="modal-button modal-button-secondary" id="user_cancel">Cancel</button>
                <button class="modal-button modal-button-primary" id="user_submit">Create</button>
            </div>
        </div>
    </div>

    <script src="/static/sso-admin.js"></script>
    <script src="/static/app.js"></script>

</body>

</html>
