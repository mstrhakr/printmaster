<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>PrintMaster Server</title>
    <script>window.__pm_shared = window.__pm_shared || {};</script>
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><rect x='16' y='8' width='32' height='12' fill='%234a5568' rx='2'/><rect x='12' y='20' width='40' height='24' fill='%23718096' rx='3'/><rect x='16' y='24' width='32' height='16' fill='%23cbd5e0' rx='2'/><rect x='20' y='28' width='8' height='2' fill='%234299e1'/><rect x='20' y='32' width='12' height='2' fill='%234299e1'/><rect x='20' y='36' width='10' height='2' fill='%234299e1'/><circle cx='46' cy='32' r='3' fill='%2348bb78'/><rect x='16' y='44' width='32' height='12' fill='%234a5568' rx='2'/><rect x='20' y='48' width='24' height='4' fill='%23e2e8f0'/></svg>">
    <!-- flatpickr is injected centrally from common/web/shared.js -->
    <link rel="stylesheet" href="/static/shared.css">
    <link rel="stylesheet" href="/static/style.css">
    <script src="/static/shared.js"></script>
    <script src="/static/cards.js"></script>
    <script src="/static/metrics.js"></script>
</head>

<body>
    <div class="header-flex"
        style="display: flex; align-items: center; margin-bottom: 12px; justify-content: space-between;">
        <div style="display: flex; align-items: center; gap: 20px;">
            <h1 style="margin: 0;">PrintMaster Server</h1>
            <div id="server_status" style="font-size:14px;color:var(--muted);">Loading...</div>
        </div>
        <div style="display:flex;align-items:center;gap:12px;">
            <button id="join_token_btn" title="Add an agent" class="modal-button modal-button-primary" style="display:none;">Add Agent</button>
            <label class="theme-toggle">
                <input type="checkbox" id="theme-toggle-checkbox">
                <div class="theme-toggle-slider">
                    <div class="theme-toggle-icon"></div>
                </div>
            </label>
            <button id="logout_btn" style="display:none;" title="Log out" class="modal-button">Log out</button>
        </div>
    </div>

    <!-- Main content container with floating appearance -->
    <div class="content-container">
        <div class="tabbar">
            <!-- Hamburger menu for mobile -->
            <div class="hamburger-menu">
                <div class="hamburger-header">
                    <span id="current_tab_label">Menu - Agents</span>
                    <div class="hamburger-icon">
                        <div></div>
                        <div></div>
                        <div></div>
                    </div>
                </div>
            </div>
            <div class="mobile-nav" id="mobile_nav">
                <button class="tab active" data-target="agents">Agents</button>
                <button class="tab" data-target="devices">Devices</button>
                <button class="tab" data-target="metrics">Metrics</button>
                <button class="tab" data-target="logs">Logs</button>
            </div>
            <!-- Desktop tabs -->
            <div class="desktop-tabs" id="desktop_tabs">
                <button class="tab active" data-target="agents">Agents</button>
                <button class="tab" data-target="devices">Devices</button>
                <button class="tab" data-target="metrics">Metrics</button>
                <button class="tab" data-target="logs">Logs</button>
            </div>
        </div>

        <!-- Agents Tab -->
        <div style="margin-top:12px;" data-tab="agents">
            <h3>Connected Agents</h3>
            <div id="agents_stats" style="display:flex;gap:12px;margin-bottom:12px;font-size:13px;"></div>
            <div id="agents_list">
                <div style="color:var(--muted);">Loading agents...</div>
            </div>
        </div>

        <!-- Devices Tab -->
        <div style="margin-top:12px;" data-tab="devices" class="hidden">
            <h3>All Devices</h3>
            
            <div style="display:flex;gap:12px;align-items:center;margin-bottom:12px;flex-wrap:wrap;">
                <input type="text" id="devices_search" placeholder="Search devices..."
                    style="padding:6px 12px;width:200px;" />
                <select id="devices_agent_filter" style="padding:6px 12px;">
                    <option value="">All Agents</option>
                </select>
            </div>

            <div id="devices_stats" style="display:flex;gap:12px;margin-bottom:12px;font-size:13px;"></div>
            <div class="device-cards-container" id="devices_cards"></div>
        </div>

        <!-- Metrics Tab -->
        <div style="margin-top:12px;" data-tab="metrics" class="hidden">
            <h3>Metrics</h3>
            <div id="metrics_stats" style="display:flex;gap:12px;margin-bottom:12px;font-size:13px;"></div>
            <div id="metrics_content" style="font-size:13px;color:var(--muted)">Loading metrics...</div>
        </div>

        <!-- Tenants / Customers Tab (rendered dynamically) -->
        <template id="tab-template-tenants">
            <div style="margin-top:12px;" data-tab="tenants" class="hidden">
                <h3>Customers</h3>
                <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:12px;">
                    <div style="color:var(--muted);">Manage tenants and onboarding tokens</div>
                    <div>
                        <button id="new_tenant_btn">New Tenant</button>
                    </div>
                </div>

                <div id="tenants_list">
                    <div style="color:var(--muted);">Loading tenants...</div>
                </div>
            </div>
        </template>

        <!-- Settings Tab (rendered dynamically) -->
        <template id="tab-template-settings">
            <div style="margin-top:12px;" data-tab="settings" class="hidden">
                <h3>Settings</h3>

                <div class="subtab-bar" id="settings_subtab_bar">
                    <button class="subtab settings-subtab" data-settingsview="server">Server Settings</button>
                    <button class="subtab settings-subtab active" data-settingsview="fleet">Fleet Settings</button>
                </div>

                <div class="settings-view-panel hidden" data-settingsview-panel="server">
                    <div class="panel">
                        <h4 style="margin-top:0;color:var(--highlight)">Single Sign-On (OIDC)</h4>
                        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:12px;flex-wrap:wrap;">
                            <div style="color:var(--muted);font-size:13px;max-width:520px;">
                                Connect identity providers for the hosted login page. Providers can be tenant-specific or global.
                            </div>
                            <div>
                                <button id="sso_add_provider_btn">Add Provider</button>
                            </div>
                        </div>
                        <div id="sso_providers_list" class="card" style="padding:12px;overflow:auto;">
                            <div class="muted-text">Loading identity providers…</div>
                        </div>
                    </div>
                </div>

                <div class="settings-view-panel" data-settingsview-panel="fleet">
                    <div class="managed-settings-grid">
                        <div class="panel" id="managed_settings_panel">
                            <div class="settings-scope-bar">
                                <div class="settings-scope-buttons">
                                    <button class="settings-scope-btn active" data-scope="global">Global Defaults</button>
                                    <button class="settings-scope-btn" data-scope="tenant">Tenant Overrides</button>
                                </div>
                                <div class="settings-tenant-controls hidden" id="settings_tenant_controls">
                                    <label>
                                        <span>Tenant</span>
                                        <select id="settings_tenant_select"></select>
                                    </label>
                                    <button id="settings_reset_overrides_btn" class="ghost-btn">Clear Overrides</button>
                                </div>
                                <div class="settings-updated" id="settings_last_updated"></div>
                            </div>

                            <div id="settings_form_root" class="settings-form-root">
                                <div class="muted-text">Loading managed settings…</div>
                            </div>

                            <div class="settings-actions">
                                <div class="settings-status" id="settings_status"></div>
                                <div class="settings-action-buttons">
                                    <button id="settings_discard_btn" class="ghost-btn">Discard Changes</button>
                                    <button id="settings_save_btn" class="primary">Save Changes</button>
                                </div>
                            </div>
                        </div>

                        <div class="panel" id="settings_summary_panel">
                            <h4 style="margin-top:0;color:var(--highlight);">Override Summary</h4>
                            <div id="settings_override_list" class="muted-text">Select a tenant to view overrides.</div>
                        </div>
                    </div>
                </div>
            </div>
        </template>

        <!-- Users Tab (rendered dynamically) -->
        <template id="tab-template-users">
            <div style="margin-top:12px;" data-tab="users" class="hidden">
                <h3>Users</h3>
                <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:12px;">
                    <div style="color:var(--muted);">Manage local users and roles</div>
                    <div>
                        <button id="new_user_btn">New User</button>
                    </div>
                </div>

                <div id="users_list">
                    <div style="color:var(--muted);">Loading users...</div>
                </div>
            </div>
        </template>

        <!-- Logs Tab -->
        <div class="hidden" style="margin-top:12px;" data-tab="logs">
            <h3>Logs</h3>
            <div class="subtab-bar" id="logs_subtab_bar">
                <button class="subtab log-subtab active" data-logview="system">System Logs</button>
                <button class="subtab log-subtab" data-logview="audit" data-role="admin" style="display:none">Audit Logs</button>
            </div>

            <div class="panel log-panel" data-logview-panel="system">
                <div class="log-controls">
                    <label class="log-control"><input type="checkbox" id="pause_autoscroll" /> Pause auto-scroll</label>
                    <select id="log_level_filter">
                        <option value="">All Levels</option>
                        <option value="ERROR">ERROR</option>
                        <option value="WARN">WARN</option>
                        <option value="INFO">INFO</option>
                        <option value="DEBUG">DEBUG</option>
                        <option value="TRACE">TRACE</option>
                    </select>
                    <input type="text" id="log_search_filter" placeholder="Search logs..." />
                    <button id="copy_logs_btn">Copy Logs</button>
                    <button id="download_logs_btn">Download Logs</button>
                    <button id="clear_log_btn">Clear Log</button>
                </div>
                <pre id="log"></pre>
            </div>

            <div class="panel log-panel hidden" data-logview-panel="audit" data-role="admin" style="display:none">
                <div class="log-controls audit-controls">
                    <div class="audit-filter-grid">
                        <label class="log-control column">
                            <span>Time Range</span>
                            <select id="audit_time_filter">
                                <option value="24">Last 24h</option>
                                <option value="168">Last 7 days</option>
                                <option value="720">Last 30 days</option>
                            </select>
                        </label>
                        <label class="log-control column">
                            <span>Actor ID</span>
                            <input type="text" id="audit_actor_filter" placeholder="Optional actor identifier" />
                        </label>
                        <label class="log-control column">
                            <span>Tenant</span>
                            <input type="text" id="audit_tenant_filter" placeholder="Tenant ID or name" />
                        </label>
                        <label class="log-control column">
                            <span>Action</span>
                            <input type="text" id="audit_action_filter" list="audit_action_suggestions" placeholder="Filter by action keyword" />
                            <datalist id="audit_action_suggestions"></datalist>
                        </label>
                        <label class="log-control column">
                            <span>Search</span>
                            <input type="text" id="audit_search_filter" placeholder="Search actor, target, IP, metadata..." />
                        </label>
                        <div class="audit-severity-group">
                            <span>Severity</span>
                            <div class="audit-severity-options" id="audit_severity_filter">
                                <label class="audit-severity-pill">
                                    <input type="checkbox" class="audit-severity-option" value="error" checked />
                                    <span>Error</span>
                                </label>
                                <label class="audit-severity-pill">
                                    <input type="checkbox" class="audit-severity-option" value="warn" checked />
                                    <span>Warning</span>
                                </label>
                                <label class="audit-severity-pill">
                                    <input type="checkbox" class="audit-severity-option" value="info" checked />
                                    <span>Info</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="audit-controls-row">
                        <label class="log-control">
                            <input type="checkbox" id="audit_live_toggle" /> Auto-refresh (15s)
                        </label>
                        <div class="audit-controls-actions">
                            <button class="ghost-btn" id="audit_clear_filters_btn">Reset Filters</button>
                            <button id="refresh_audit_logs_btn">Refresh</button>
                        </div>
                    </div>
                    <div class="audit-summary" id="audit_summary" hidden>
                        <span id="audit_summary_counts">0 entries</span>
                        <span id="audit_summary_updated">Updated just now</span>
                        <span id="audit_live_status" class="audit-live-status">Auto-refresh off</span>
                    </div>
                </div>
                <div id="audit_logs_table" class="table-wrapper">
                    <div class="muted-text">Audit entries load here for admins.</div>
                </div>
            </div>
        </div>

    </div> <!-- End content-container -->

    <!-- Toast notification container -->
    <div class="toast-container" id="toast_container"></div>

    <!-- Login Modal -->
    <div class="modal" id="login_modal" style="display:none;">
        <div class="modal-content" style="max-width:420px;">
            <div class="modal-header">
                <span class="modal-title">Sign In</span>
            </div>
            <div class="modal-body">
                <div style="margin-bottom:8px;color:var(--muted);">Sign in to access PrintMaster.</div>
                <label style="display:block;margin-bottom:6px;">Username</label>
                <input id="login_username" type="text" style="width:100%;padding:8px;margin-bottom:8px;border-radius:4px;border:1px solid var(--border);" />
                <label style="display:block;margin-bottom:6px;">Password</label>
                <input id="login_password" type="password" style="width:100%;padding:8px;margin-bottom:8px;border-radius:4px;border:1px solid var(--border);" />
                <div id="login_error" style="color:var(--danger);display:none;margin-bottom:8px;font-size:13px;"></div>
            </div>
            <div class="modal-footer">
                <button class="modal-button modal-button-secondary" id="login_cancel">Cancel</button>
                <button class="modal-button modal-button-primary" id="login_submit">Sign In</button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal" id="confirm_modal" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-title" id="confirm_modal_title">Confirm Action</span>
                <span class="modal-close" id="confirm_modal_close_x">&times;</span>
            </div>
            <div class="modal-body">
                <p id="confirm_modal_message">Are you sure?</p>
            </div>
            <div class="modal-footer">
                <button class="modal-button modal-button-secondary" id="confirm_modal_cancel">Cancel</button>
                <button class="modal-button modal-button-primary" id="confirm_modal_confirm">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Agent Details Modal -->
    <div class="modal" id="agent_details_modal" style="display:none;">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <span class="modal-title" id="agent_details_title">Agent Details</span>
                <span class="modal-close" id="agent_details_close_x">&times;</span>
            </div>
            <div class="modal-body" id="agent_details_body" style="max-height: 500px; overflow-y: auto;">
                <div style="color:var(--muted);">Loading...</div>
            </div>
            <div class="modal-footer">
                <button class="modal-button modal-button-secondary" id="agent_details_close">Close</button>
            </div>
        </div>
    </div>

    <!-- Printer Details modal with overlay (shared) -->
    <div id="printer_details_overlay" class="modal" style="display:none;">
        <div id="printer_details_modal" class="printer-details-dialog modal-content" style="max-width:900px;">
            <button class="modal-close-x" id="printer_details_close_x" title="Close">&times;</button>
            <h3 id="printer_details_title" style="margin-top:0;color:var(--highlight)">Printer Details</h3>
            <div id="printer_details_body"
                style="overflow-x:hidden;overflow-y:auto;font-family:system-ui;color:var(--text);word-wrap:break-word;flex:1;max-height:60vh;padding-right:8px;">
            </div>
            <div id="printer_details_actions" style="margin-top:16px;display:flex;justify-content:flex-end;gap:8px;flex-shrink:0">
                <button class="modal-button modal-button-secondary" id="printer_details_close">Close</button>
            </div>
        </div>
    </div>

    <!-- Add Agent Multi-step Modal -->
    <div class="modal modal-overlay" id="add_agent_modal" style="display:none;">
        <div class="modal-dialog" style="max-width:720px;">
            <div class="modal-header">
                <span class="modal-title" id="add_agent_title">Add Agent</span>
                <span class="modal-close" id="add_agent_close_x">&times;</span>
            </div>
            <div class="modal-body" id="add_agent_body" style="max-height:520px;overflow-y:auto;">
                <div id="add_agent_step_indicator" style="font-size:13px;color:var(--muted);margin-bottom:8px;">Step 1/3</div>
                <div id="add_agent_content">
                    <!-- Dynamic content rendered by app.js -->
                </div>
            </div>
            <div class="modal-footer" id="add_agent_footer">
                <button class="modal-button modal-button-secondary" id="add_agent_cancel">Cancel</button>
                <button class="modal-button modal-button-primary" id="add_agent_primary">Next</button>
            </div>
        </div>
    </div>

    <!-- Generic Input Modal (used for small prompts, replaces prompt()) -->
    <div class="modal" id="input_modal" style="display:none;">
        <div class="modal-content" style="max-width:520px;">
            <div class="modal-header">
                <span class="modal-title" id="input_modal_title">Input</span>
                <span class="modal-close" id="input_modal_close_x">&times;</span>
            </div>
            <div class="modal-body" id="input_modal_body">
                <div id="input_modal_label" style="margin-bottom:8px;color:var(--muted);"></div>
                <input id="input_modal_input" type="text" style="width:100%;padding:8px;border-radius:4px;border:1px solid var(--border);" />
            </div>
            <div class="modal-footer">
                <button class="modal-button modal-button-secondary" id="input_modal_cancel">Cancel</button>
                <button class="modal-button modal-button-primary" id="input_modal_ok">OK</button>
            </div>
        </div>
    </div>

    <!-- SSO Provider Modal -->
    <div class="modal" id="sso_modal" style="display:none;">
        <div class="modal-content" style="max-width:640px;">
            <div class="modal-header">
                <span class="modal-title" id="sso_modal_title">Add OIDC Provider</span>
                <span class="modal-close" id="sso_modal_close">&times;</span>
            </div>
            <form id="sso_modal_form">
                <div class="modal-body" style="max-height:70vh;overflow:auto;display:flex;flex-direction:column;gap:16px;">
                    <label style="display:flex;flex-direction:column;font-size:13px;gap:6px;">
                        <span>Provider Template</span>
                        <select id="sso_template_select" style="padding:8px;border-radius:4px;border:1px solid var(--border);">
                            <option value="generic">Generic OIDC</option>
                            <option value="entra">Microsoft Entra ID</option>
                        </select>
                    </label>
                    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;">
                        <label style="display:flex;flex-direction:column;font-size:13px;gap:6px;">
                            <span>Display Name</span>
                            <input id="sso_display_name" type="text" required style="padding:8px;border-radius:4px;border:1px solid var(--border);" placeholder="Acme SSO" />
                        </label>
                        <label style="display:flex;flex-direction:column;font-size:13px;gap:6px;">
                            <span>Slug</span>
                            <input id="sso_slug" type="text" style="padding:8px;border-radius:4px;border:1px solid var(--border);" placeholder="acme" />
                            <small style="color:var(--muted);">Lowercase letters, numbers, and hyphen.</small>
                        </label>
                        <label style="display:flex;flex-direction:column;font-size:13px;gap:6px;">
                            <span>Tenant Scope</span>
                            <select id="sso_tenant" style="padding:8px;border-radius:4px;border:1px solid var(--border);"></select>
                            <small style="color:var(--muted);">Leave blank to make the provider global.</small>
                        </label>
                        <label style="display:flex;flex-direction:column;font-size:13px;gap:6px;">
                            <span>Default Role</span>
                            <select id="sso_default_role" style="padding:8px;border-radius:4px;border:1px solid var(--border);">
                                <option value="user">User</option>
                                <option value="admin">Admin</option>
                            </select>
                        </label>
                    </div>
                    <label class="preset-section preset-generic" data-display="flex" style="display:flex;flex-direction:column;font-size:13px;gap:6px;">
                        <span>Issuer URL</span>
                        <input id="sso_issuer" type="text" style="padding:8px;border-radius:4px;border:1px solid var(--border);" placeholder="https://login.microsoftonline.com/..." />
                    </label>
                    <label class="preset-section preset-entra" data-display="flex" style="display:none;flex-direction:column;font-size:13px;gap:6px;">
                        <span>Microsoft Entra Tenant (Directory) ID</span>
                        <input id="sso_entra_tenant" type="text" style="padding:8px;border-radius:4px;border:1px solid var(--border);" placeholder="11111111-2222-3333-4444-555555555555" />
                        <small style="color:var(--muted);">We derive the issuer URL from this tenant ID.</small>
                    </label>
                    <label style="display:flex;flex-direction:column;font-size:13px;gap:6px;">
                        <span>Client ID</span>
                        <input id="sso_client_id" type="text" style="padding:8px;border-radius:4px;border:1px solid var(--border);" />
                    </label>
                    <label style="display:flex;flex-direction:column;font-size:13px;gap:6px;">
                        <span>Client Secret</span>
                        <input id="sso_client_secret" type="password" style="padding:8px;border-radius:4px;border:1px solid var(--border);" />
                        <small style="color:var(--muted);">Leave blank to keep the existing secret when editing.</small>
                    </label>
                    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;">
                        <label style="display:flex;flex-direction:column;font-size:13px;gap:6px;">
                            <span>Button Text</span>
                            <input id="sso_button_text" type="text" style="padding:8px;border-radius:4px;border:1px solid var(--border);" placeholder="Sign in with Contoso" />
                        </label>
                        <label style="display:flex;flex-direction:column;font-size:13px;gap:6px;">
                            <span>Icon URL</span>
                            <input id="sso_icon" type="text" style="padding:8px;border-radius:4px;border:1px solid var(--border);" placeholder="https://.../logo.svg" />
                        </label>
                    </div>
                    <label style="display:flex;flex-direction:column;font-size:13px;gap:6px;">
                        <span>Button Style (optional CSS classes)</span>
                        <input id="sso_button_style" type="text" style="padding:8px;border-radius:4px;border:1px solid var(--border);" placeholder="btn btn-accent" />
                    </label>
                    <label style="display:flex;flex-direction:column;font-size:13px;gap:6px;">
                        <span>Scopes</span>
                        <input id="sso_scopes" type="text" style="padding:8px;border-radius:4px;border:1px solid var(--border);" />
                        <small style="color:var(--muted);">Separate scopes with spaces or commas. "openid" is always included.</small>
                    </label>
                    <label style="display:flex;align-items:center;gap:8px;font-size:13px;">
                        <input id="sso_auto_login" type="checkbox" />
                        <span>Automatically redirect users to this provider when it is the only option.</span>
                    </label>
                    <div id="sso_modal_error" style="display:none;color:var(--danger);font-size:13px;"></div>
                    <div id="sso_entra_instructions" class="sso-modal-helper preset-entra" data-display="block" style="display:none;">
                        <div style="font-weight:600;margin-bottom:6px;">Microsoft Entra setup checklist</div>
                        <ul>
                            <li>Create an app registration in <a href="https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/CreateApplicationBlade/quickStartType~/null/isMSAApp~/false" target="_blank" rel="noopener" class="sso-entra-portal-link">Microsoft Entra admin center</a>.</li>
                            <li>Select “Accounts in this organization only” and add <code id="sso_modal_redirect_uri_text">https://example.com/auth/oidc/callback</code> as a Web redirect URI.</li>
                            <li>Copy the Application (client) ID, create a client secret, and keep the Directory (tenant) ID.</li>
                            <li>Paste the client ID/secret here; the issuer URL is generated from your tenant ID automatically.</li>
                        </ul>
                        <button type="button" class="link-button" id="sso_modal_copy_redirect">Copy redirect URI</button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="modal-button modal-button-secondary" id="sso_modal_cancel">Cancel</button>
                    <button type="submit" class="modal-button modal-button-primary" id="sso_modal_submit">Save Provider</button>
                </div>
            </form>
        </div>
    </div>

    <!-- User Modal (create/edit) -->
    <div class="modal" id="user_modal" style="display:none;">
        <div class="modal-content" style="max-width:520px;">
            <div class="modal-header">
                <span class="modal-title" id="user_modal_title">Add User</span>
                <span class="modal-close" id="user_modal_close_x">&times;</span>
            </div>
            <div class="modal-body">
                <label style="display:block;margin-bottom:6px;">Username</label>
                <input id="user_username" type="text" style="width:100%;padding:8px;margin-bottom:8px;border-radius:4px;border:1px solid var(--border);" />
                <label style="display:block;margin-bottom:6px;">Email</label>
                <input id="user_email" type="text" style="width:100%;padding:8px;margin-bottom:8px;border-radius:4px;border:1px solid var(--border);" />
                <label style="display:block;margin-bottom:6px;">Password</label>
                <input id="user_password" type="password" style="width:100%;padding:8px;margin-bottom:8px;border-radius:4px;border:1px solid var(--border);" />
                <label style="display:block;margin-bottom:6px;">Role</label>
                <select id="user_role" style="width:100%;padding:8px;margin-bottom:8px;border-radius:4px;border:1px solid var(--border);">
                    <option value="user">User</option>
                    <option value="readonly">Read-only</option>
                    <option value="admin">Admin</option>
                </select>
                <label style="display:block;margin-bottom:6px;">Tenant (optional)</label>
                <select id="user_tenant" style="width:100%;padding:8px;margin-bottom:8px;border-radius:4px;border:1px solid var(--border);">
                    <option value="">(Global / Server)</option>
                </select>
                <div id="user_error" style="color:var(--danger);display:none;margin-top:6px;"></div>
            </div>
            <div class="modal-footer">
                <button class="modal-button modal-button-secondary" id="user_cancel">Cancel</button>
                <button class="modal-button modal-button-primary" id="user_submit">Create</button>
            </div>
        </div>
    </div>

    <!-- Tenant Modal -->
    <div class="modal" id="tenant_modal" style="display:none;">
        <div class="modal-content" style="max-width:520px;">
            <div class="modal-header">
                <span class="modal-title" id="tenant_modal_title">New Customer</span>
                <button class="modal-close-x" id="tenant_modal_close_x" title="Close">&times;</button>
            </div>
            <div class="modal-body" style="display:flex;flex-direction:column;gap:10px;">
                <label style="display:flex;flex-direction:column;font-size:13px;gap:4px;">
                    Customer Name
                    <input id="tenant_name" type="text" style="width:100%;padding:8px;border:1px solid var(--border);border-radius:4px;" placeholder="Acme Corp" />
                </label>
                <label style="display:flex;flex-direction:column;font-size:13px;gap:4px;">
                    Business Unit / Site
                    <input id="tenant_business_unit" type="text" style="width:100%;padding:8px;border:1px solid var(--border);border-radius:4px;" placeholder="North Campus" />
                </label>
                <label style="display:flex;flex-direction:column;font-size:13px;gap:4px;">
                    Contact Name
                    <input id="tenant_contact_name" type="text" style="width:100%;padding:8px;border:1px solid var(--border);border-radius:4px;" placeholder="Jane Smith" />
                </label>
                <label style="display:flex;flex-direction:column;font-size:13px;gap:4px;">
                    Contact Email
                    <input id="tenant_contact_email" type="email" style="width:100%;padding:8px;border:1px solid var(--border);border-radius:4px;" placeholder="jane@example.com" />
                </label>
                <label style="display:flex;flex-direction:column;font-size:13px;gap:4px;">
                    Contact Phone
                    <input id="tenant_contact_phone" type="text" style="width:100%;padding:8px;border:1px solid var(--border);border-radius:4px;" placeholder="+1 800 555 1234" />
                </label>
                <label style="display:flex;flex-direction:column;font-size:13px;gap:4px;">
                    Billing / Reference Code
                    <input id="tenant_billing_code" type="text" style="width:100%;padding:8px;border:1px solid var(--border);border-radius:4px;" placeholder="ACME-OPS-01" />
                </label>
                <label style="display:flex;flex-direction:column;font-size:13px;gap:4px;">
                    Address
                    <textarea id="tenant_address" rows="2" style="width:100%;padding:8px;border:1px solid var(--border);border-radius:4px;"></textarea>
                </label>
                <label style="display:flex;flex-direction:column;font-size:13px;gap:4px;">
                    Notes
                    <textarea id="tenant_description" rows="2" style="width:100%;padding:8px;border:1px solid var(--border);border-radius:4px;"></textarea>
                </label>
                <div id="tenant_error" style="color:var(--danger);display:none;font-size:13px;"></div>
            </div>
            <div class="modal-footer">
                <button class="modal-button modal-button-secondary" id="tenant_cancel">Cancel</button>
                <button class="modal-button modal-button-primary" id="tenant_save">Create</button>
            </div>
        </div>
    </div>

    <script src="/static/sso-admin.js"></script>
    <script src="/static/rbac.js"></script>
    <script src="/static/app.js"></script>

</body>

</html>
