// Minimal flatpickr shim for environments where full flatpickr is not embedded.
// Provides a tiny subset of the flatpickr API used by PrintMaster UI: constructor, setDate, selectedDates, onChange/onReady callbacks.
(function(global){
  function ensureElement(target){
    if (!target) return null;
    if (typeof target === 'string') return document.querySelector(target);
    return target;
  }

  function FlatpickrShim(target, config){
    this.input = ensureElement(target) || document.createElement('input');
    this.config = config || {};
    this.selectedDates = [];
    this._onChange = config.onChange || function(){};
    this._onReady = config.onReady || function(){};

    // store instance on element
    try { this.input._flatpickr = this; } catch(e){}

    // Mark as readOnly if requested by code elsewhere
    try { this.input.readOnly = true; } catch(e){}

    var self = this;
    // Call onReady asynchronously to mimic flatpickr
    setTimeout(function(){
      try { self._onReady(self.selectedDates, '', self); } catch(e){ console.error(e); }
    }, 0);

    return this;
  }

  FlatpickrShim.prototype.setDate = function(dates, triggerChange){
    // dates can be [start, end] or single
    var arr = Array.isArray(dates) ? dates : [dates];
    this.selectedDates = arr.map(function(d){ return (d instanceof Date) ? d : new Date(d); });
    // Update input value for basic UX
    try {
      if (this.selectedDates.length === 2) {
        this.input.value = this.selectedDates[0].toLocaleString() + ' - ' + this.selectedDates[1].toLocaleString();
      } else if (this.selectedDates.length === 1) {
        this.input.value = this.selectedDates[0].toLocaleString();
      }
    } catch(e){}

    if (triggerChange) {
      try { this._onChange(this.selectedDates, this.input.value, this); } catch(e){ console.error(e); }
    }
  };

  // Lightweight helper to emulate flatpickr API
  function flatpickr(targetSelectorOrEl, config){
    var el = (typeof targetSelectorOrEl === 'string') ? document.querySelector(targetSelectorOrEl) : targetSelectorOrEl;
    var inst = (el && el._flatpickr) ? el._flatpickr : new FlatpickrShim(el, config || {});
    return inst;
  }

  // Expose
  global.flatpickr = flatpickr;
  // Also expose a minimal CSS class name to avoid runtime errors
})(window);
