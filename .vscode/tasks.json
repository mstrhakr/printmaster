{
  "version": "2.0.0",
  "tasks": [
    // ========== Build Tasks ==========
    {
      "label": "Build: Agent (Dev)",
      "type": "shell",
      "command": ".\\build.ps1",
      "args": ["agent"],
      "group": {
        "kind": "build",
        "isDefault": true
      },
      "problemMatcher": [],
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false,
        "clear": false
      }
    },
    {
      "label": "Build: Server (Dev)",
      "type": "shell",
      "command": ".\\build.ps1",
      "args": ["server"],
      "group": "build",
      "problemMatcher": [],
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false,
        "clear": false
      }
    },
    {
      "label": "Build: Both (Dev)",
      "type": "shell",
      "command": ".\\build.ps1",
      "args": ["both"],
      "group": "build",
      "problemMatcher": [],
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false,
        "clear": false
      }
    },
    {
      "label": "Build: Clean artifacts",
      "type": "shell",
      "command": ".\\build.ps1",
      "args": ["clean"],
      "group": "build",
      "problemMatcher": [],
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false,
        "clear": false
      }
    },
      {
        "label": "Prep: Agent (Kill + Build Dev)",
        "type": "shell",
        "command": "echo Agent build ready",
        "dependsOrder": "sequence",
        "dependsOn": [
          "Kill: PrintMaster processes",
          "Build: Agent (Dev)"
        ],
        "problemMatcher": [],
        "presentation": {
          "echo": false,
          "reveal": "always",
          "focus": false,
          "panel": "shared",
          "showReuseMessage": false,
          "clear": false
        }
      },
      {
        "label": "Prep: Server (Kill + Build Dev)",
        "type": "shell",
        "command": "echo Server build ready",
        "dependsOrder": "sequence",
        "dependsOn": [
          "Kill: PrintMaster processes",
          "Build: Server (Dev)"
        ],
        "problemMatcher": [],
        "presentation": {
          "echo": false,
          "reveal": "always",
          "focus": false,
          "panel": "shared",
          "showReuseMessage": false,
          "clear": false
        }
      },
    
    // ========== Test Tasks ==========
    {
      "label": "Test: Agent (all)",
      "type": "shell",
      "command": "cd agent; go test ./... -v",
      "group": "test",
      "problemMatcher": [],
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": true,
        "panel": "shared",
        "showReuseMessage": false,
        "clear": true
      }
    },
    {
      "label": "Test: Server (all)",
      "type": "shell",
      "command": "cd server; go test ./... -v",
      "group": "test",
      "problemMatcher": [],
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": true,
        "panel": "shared",
        "showReuseMessage": false,
        "clear": true
      }
    },
    
    // ========== Release Tasks ==========
    {
      "label": "Release: Agent Patch",
      "type": "shell",
      "command": ".\\release.ps1",
      "args": ["agent", "patch"],
      "group": "none",
      "problemMatcher": [],
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": true,
        "panel": "dedicated",
        "showReuseMessage": false,
        "clear": true
      }
    },
    {
      "label": "Release: Agent Minor",
      "type": "shell",
      "command": ".\\release.ps1",
      "args": ["agent", "minor"],
      "group": "none",
      "problemMatcher": [],
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": true,
        "panel": "dedicated",
        "showReuseMessage": false,
        "clear": true
      }
    },
    {
      "label": "Release: Agent Major",
      "type": "shell",
      "command": ".\\release.ps1",
      "args": ["agent", "major"],
      "group": "none",
      "problemMatcher": [],
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": true,
        "panel": "dedicated",
        "showReuseMessage": false,
        "clear": true
      }
    },
    {
      "label": "Release: Server Patch",
      "type": "shell",
      "command": ".\\release.ps1",
      "args": ["server", "patch"],
      "group": "none",
      "problemMatcher": [],
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": true,
        "panel": "dedicated",
        "showReuseMessage": false,
        "clear": true
      }
    },
    {
      "label": "Release: Both Patch",
      "type": "shell",
      "command": ".\\release.ps1",
      "args": ["both", "patch"],
      "group": "none",
      "problemMatcher": [],
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": true,
        "panel": "dedicated",
        "showReuseMessage": false,
        "clear": true
      }
    },
    
    // ========== Git Tasks ==========
    {
      "label": "Git: Status",
      "type": "shell",
      "command": "git status",
      "group": "none",
      "problemMatcher": [],
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": true,
        "panel": "shared",
        "showReuseMessage": false,
        "clear": true
      }
    },
    {
      "label": "Git: Commit All",
      "type": "shell",
      "command": "git add -A; git commit",
      "group": "none",
      "problemMatcher": [],
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": true,
        "panel": "shared",
        "showReuseMessage": false,
        "clear": true
      }
    },
    {
      "label": "Git: Push",
      "type": "shell",
      "command": "git push",
      "group": "none",
      "problemMatcher": [],
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": true,
        "panel": "shared",
        "showReuseMessage": false,
        "clear": true
      }
    },
    {
      "label": "Git: Pull",
      "type": "shell",
      "command": "git pull",
      "group": "none",
      "problemMatcher": [],
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": true,
        "panel": "shared",
        "showReuseMessage": false,
        "clear": true
      }
    },
    
    // ========== Utility Tasks ==========
    {
      "label": "Kill: PrintMaster processes",
      "type": "shell",
      "command": ".\\scripts\\kill_printmaster_by_port.ps1",
      "group": "none",
      "problemMatcher": [],
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false,
        "clear": false
      }
    },
    {
      "label": "Show Build Log",
      "type": "shell",
      "command": "Get-Content",
      "args": ["logs\\build.log", "-Tail", "50"],
      "group": "none",
      "problemMatcher": [],
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": true,
        "panel": "shared",
        "showReuseMessage": false,
        "clear": true
      }
    },
    {
      "label": "Show Version",
      "type": "shell",
      "command": "Write-Host 'Agent:' (Get-Content VERSION) '| Server:' (Get-Content server\\VERSION)",
      "group": "none",
      "problemMatcher": [],
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": true,
        "panel": "shared",
        "showReuseMessage": false,
        "clear": true
      }
    },

    // ========== Fresh Start (DB Cleanup) Tasks ==========
    {
      "label": "Clean: Server Database",
      "type": "shell",
      "command": "Remove-Item -Path '.\\server\\server.db' -Force -ErrorAction SilentlyContinue; Write-Host 'Server database cleaned'",
      "group": "none",
      "problemMatcher": [],
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false,
        "clear": false
      }
    },
    {
      "label": "Clean: Agent Data",
      "type": "shell",
      "command": "$dataDir = Join-Path $env:LOCALAPPDATA 'PrintMaster'; if (Test-Path $dataDir) { Remove-Item -Path $dataDir -Recurse -Force }; Write-Host 'Agent data directory cleaned:' $dataDir",
      "group": "none",
      "problemMatcher": [],
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false,
        "clear": false
      }
    },
    {
      "label": "Clean: All Databases",
      "type": "shell",
      "command": "echo Cleaning all databases...",
      "dependsOrder": "sequence",
      "dependsOn": [
        "Clean: Server Database",
        "Clean: Agent Data"
      ],
      "problemMatcher": [],
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false,
        "clear": false
      }
    },
    {
      "label": "Prep: Server (Fresh Start)",
      "type": "shell",
      "command": "echo Server ready for fresh start",
      "dependsOrder": "sequence",
      "dependsOn": [
        "Kill: PrintMaster processes",
        "Clean: Server Database",
        "Build: Server (Dev)"
      ],
      "problemMatcher": [],
      "presentation": {
        "echo": false,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false,
        "clear": false
      }
    },
    {
      "label": "Prep: Agent (Fresh Start)",
      "type": "shell",
      "command": "echo Agent ready for fresh start",
      "dependsOrder": "sequence",
      "dependsOn": [
        "Kill: PrintMaster processes",
        "Clean: Agent Data",
        "Build: Agent (Dev)"
      ],
      "problemMatcher": [],
      "presentation": {
        "echo": false,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false,
        "clear": false
      }
    },
    {
      "label": "Prep: Both (Fresh Start)",
      "type": "shell",
      "command": "echo Both ready for fresh start",
      "dependsOrder": "sequence",
      "dependsOn": [
        "Kill: PrintMaster processes",
        "Clean: All Databases",
        "Build: Both (Dev)"
      ],
      "problemMatcher": [],
      "presentation": {
        "echo": false,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false,
        "clear": false
      }
    }
  ]
}
